<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>LED Banner - Final Fix</title>
    <style>
        body, html { 
            margin: 0; padding: 0; background: #000; 
            height: 100vh; display: flex; align-items: center; overflow: hidden; 
        }

        .led-screen {
            position: relative;
            width: 100%;
            height: 350px;
            background: #050505;
            overflow: hidden;
            display: flex;
            align-items: center;
            border-top: 3px solid #222;
            border-bottom: 3px solid #222;
        }

        /* Effet de pixels */
        .led-screen::after {
            content: "";
            position: absolute;
            inset: 0;
            background-image: radial-gradient(rgba(0,0,0,0.8) 40%, transparent 45%);
            background-size: 6px 6px;
            z-index: 10;
            pointer-events: none;
        }

        #bannerText {
            position: absolute;
            white-space: nowrap;
            font-family: 'Courier New', Courier, monospace;
            font-weight: 900;
            text-transform: uppercase;
            /* Force le départ hors-écran à droite */
            left: 100%; 
        }

        /* L'animation utilise 'left' pour une compatibilité maximale avec le texte dynamique */
        @keyframes scroll-marquee {
            0% { left: 100%; }
            100% { left: -150%; } /* -150% pour être sûr que les longs messages sortent totalement */
        }

        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        @keyframes rainbow {
            0% { color: #ff0000; } 25% { color: #ffff00; }
            50% { color: #00ff00; } 75% { color: #0000ff; } 100% { color: #ff0000; }
        }
    </style>
</head>
<body>

    <div class="led-screen">
        <div id="bannerText">CHARGEMENT...</div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwKe-M-zTheHrcr2fLyC2ppWPOMfAfBFOk_ADjQ4IuwX-z78E8-q2o0NKoFPc1MfeHnKw/exec';

        const traducteurCouleurs = {
            "blanc": "#FFFFFF", "jaune": "#FFFF00", "orange": "#FFA500", "rouge": "#FF0000",
            "vert": "#00FF00", "bleu": "#0000FF", "indigo": "#4B0082", "violet": "#EE82EE",
            "brun": "#8B4513", "gris": "#808080", "neon": "#39FF14"
        };

        async function updateBanner() {
            try {
                const response = await fetch(`${SCRIPT_URL}?t=${Date.now()}`);
                const data = await response.json();
                console.log("Mise à jour reçue :", data.text);
                
                const el = document.getElementById('bannerText');

                // 1. Mise à jour du contenu
                el.innerText = data.text || "BIENVENUE";
                el.style.fontSize = (data.size || 250) + "px";

                // 2. Couleur et effets
                let valColor = (data.color || "rouge").toLowerCase().trim();
                let anims = [];

                el.style.animation = 'none'; // Stop total
                el.style.textShadow = 'none';

                if (valColor.includes("arc en ciel")) {
                    anims.push('rainbow 3s linear infinite');
                } else {
                    const cssColor = traducteurCouleurs[valColor] || valColor;
                    el.style.color = cssColor;
                    el.style.textShadow = `0 0 20px ${cssColor}`;
                }

                if (valColor.includes("clignotant")) {
                    anims.push('blink 0.7s step-end infinite');
                }

                // 3. Animation de défilement
                const speed = parseFloat(data.speed) || 10;
                const direction = (data.direction || "gauche").toLowerCase().includes('droite') ? 'reverse' : 'normal';
                
                anims.push(`scroll-marquee ${speed}s linear infinite ${direction}`);

                // 4. Déclenchement forcé
                // On attend un cycle de rendu pour appliquer les nouvelles animations
                requestAnimationFrame(() => {
                    requestAnimationFrame(() => {
                        el.style.animation = anims.join(', ');
                    });
                });

            } catch (e) {
                console.error("Erreur de mise à jour:", e);
            }
        }

        // Vérification toutes les 20 secondes
        setInterval(updateBanner, 20000);
        updateBanner();
    </script>
</body>
</html>